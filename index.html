<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gallery</title>
<style>
  :root { --g:24px }
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fff;color:#111}
  header{padding:calc(var(--g)*.75) var(--g);font-size:14px;opacity:.6}
  .grid{display:grid;gap:var(--g);padding:var(--g);grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
  .tile{aspect-ratio:1/1;overflow:hidden;cursor:zoom-in;border-radius:6px;background:#f3f3f3}
  .tile img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .2s}
  .tile:hover img{transform:scale(1.02)}
  #viewer[hidden]{display:none}
  #viewer{position:fixed;inset:0;background:rgba(255,255,255,.98);display:grid;grid-template-rows:1fr auto;z-index:10;cursor:zoom-out}
  #viewerImg{max-width:92vw;max-height:82vh;margin:auto;display:block}
  #caption{text-align:center;padding:12px 18px 22px;font-size:13px;color:#444;word-break:break-all}
  @media (prefers-color-scheme:dark){body{background:#111;color:#e6e6e6}.tile{background:#1b1b1b}#viewer{background:rgba(0,0,0,.96)}#caption{color:#cfcfcf}}
</style>
</head>
<body>
<header>Artifacts from WASTE WORLD.</header>
<main id="grid" class="grid" aria-live="polite"></main>
<figure id="viewer" aria-modal="true" role="dialog" hidden>
  <img id="viewerImg" alt="">
  <figcaption id="caption"></figcaption>
</figure>
<script>
(async () => {
  // EDIT THESE THREE LINES
  const owner = 'mdotstrange';
  const repo  = 'websockets';
  const path  = 'Scrawls';        // folder inside the repo
  const branch = 'main';          // change if needed

  const exts = ['.jpg','.jpeg','.png','.gif','.webp','.avif'];
  const grid = document.getElementById('grid');
  const viewer = document.getElementById('viewer');
  const viewerImg = document.getElementById('viewerImg');
  const caption = document.getElementById('caption');

  function isImage(n){ n=n.toLowerCase(); return exts.some(e=>n.endsWith(e)); }
  function openViewer(src,name){ viewerImg.src = src; caption.textContent = name; viewer.hidden = false; }
  function closeViewer(){ viewer.hidden = true; viewerImg.src=''; caption.textContent=''; }
  viewer.addEventListener('click', closeViewer);
  addEventListener('keydown', e=>{ if(e.key==='Escape' && !viewer.hidden) closeViewer(); });

  try {
    const api = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
    const res = await fetch(api, {cache:'no-store'});
    if(!res.ok) throw new Error(`GitHub API ${res.status}`);
    const items = (await res.json())
      .filter(x => x.type === 'file' && isImage(x.name))
      .sort((a,b)=> a.name.localeCompare(b.name, undefined, {numeric:true, sensitivity:'base'}));

    if(items.length === 0){ grid.innerHTML = '<p style="opacity:.7">No images found.</p>'; return; }

    for(const f of items){
      const a = document.createElement('a');
      a.className = 'tile';
      a.href = f.download_url;
      a.addEventListener('click', e => { e.preventDefault(); openViewer(f.download_url, f.name); });

      const img = document.createElement('img');
      img.loading = 'lazy'; img.decoding = 'async'; img.alt = '';
      img.src = f.download_url;
      a.appendChild(img);
      grid.appendChild(a);
    }
  } catch (e) {
    console.error(e);
    grid.innerHTML = '<p style="opacity:.7">Failed to load gallery.</p>';
  }
})();
</script>
</body>
</html>
